<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Interactivo de Logística</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .correct { background-color: #d1fae5 !important; border-color: #10b981 !important; color: #065f46 !important; }
        .incorrect { background-color: #fee2e2 !important; border-color: #ef4444 !important; color: #991b1b !important; }
        .disabled { cursor: not-allowed; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4">
        
        <!-- Start Screen -->
        <div id="start-screen" class="w-full max-w-4xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900">
                Test Interactivo de <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-teal-400">Logística</span>
            </h1>
            <p class="text-gray-600 mt-2">Pon a prueba tus conocimientos</p>
            <button id="start-quiz-btn" class="mt-8 px-8 py-3 text-xl font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105 shadow-md">
                Empezar Test
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden w-full max-w-3xl bg-white p-6 md:p-8 rounded-2xl shadow-lg">
            <div class="flex justify-between items-center mb-6">
                <p id="progress-text" class="text-gray-600 font-semibold">Pregunta 1 / 20</p>
                <div class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <p id="timer" class="text-lg font-bold text-blue-600">00:00</p>
                </div>
            </div>
            <div>
                <div id="question-image-container" class="mb-4"></div>
                <h3 id="question-text" class="text-xl md:text-2xl font-bold mb-6 text-gray-900"></h3>
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>
            <div id="next-button-container" class="mt-6 text-center"></div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden w-full max-w-2xl text-center bg-white p-8 rounded-2xl shadow-lg">
            <h2 id="results-title" class="text-3xl font-bold text-gray-900 mb-2"></h2>
            <p id="results-message" class="text-lg text-gray-600 mb-6"></p>
            
            <p id="final-time" class="text-lg text-gray-500 mb-2"></p>

            <div id="score-display" class="text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-teal-400 mb-2"></div>
            <p id="score-percentage" class="text-2xl font-semibold text-gray-500 mb-8"></p>

            <div id="results-buttons" class="space-y-4 md:space-y-0 md:space-x-4 md:flex justify-center"></div>

            <div id="review-section" class="hidden mt-8 text-left max-h-60 overflow-y-auto p-4 bg-gray-50 border border-gray-200 rounded-lg">
                <h4 class="text-lg font-semibold mb-2 text-gray-700">Preguntas para repasar:</h4>
                <ul id="incorrect-questions-list"></ul>
            </div>
        </div>
    </div>

    <script>
        const allQuestions = [
            // Original Questions
            { questionText: "¿Cuál es el objetivo principal en la cima de la pirámide logística?", options: ["Reducir costes al mínimo", "Dar al cliente lo que quiere (calidad)", "Optimizar el tiempo de entrega", "Asegurar la calidad de los recursos"], correctAnswerIndex: 1 },
            { questionText: "En la pirámide logística, ¿qué elemento sostiene la base del proceso?", options: ["La calidad del producto", "Recursos/costes y tiempo", "La trazabilidad de la mercancía", "La comunicación entre equipos"], correctAnswerIndex: 1 },
            { questionText: "El nivel medio de la pirámide logística indica que la calidad es fundamental para alcanzar el objetivo principal.", options: ["Verdadero, ya que une base y cima", "Falso, se centra solo en ineficiencias", "Verdadero, pero solo para clientes internos", "Falso, ignora la calidad"], correctAnswerIndex: 0 },
            { questionText: "¿Quién es el cliente externo?", options: ["El trabajador del proceso posterior", "El que nos vende bienes y servicios", "El que paga por nuestros bienes o servicios", "El compañero que realiza la tarea anterior"], correctAnswerIndex: 2 },
            { questionText: "¿Qué define al proveedor interno?", options: ["El que recibe el trabajo en el proceso posterior", "El que nos vende bienes externos", "El trabajador respecto del proceso anterior", "El consumidor final de la cadena"], correctAnswerIndex: 0 },
            { questionText: "El cliente interno es el transportista que entrega la mercancía al almacén.", options: ["Verdadero, siempre es externo", "Falso, es un trabajador interno respecto al proceso anterior", "Verdadero, si es proveedor", "Falso, solo aplica a producción"], correctAnswerIndex: 1 },
            { questionText: "¿Qué significa eficacia en logística?", options: ["Conseguir los objetivos con el menor número de recursos", "Reducir el tiempo de almacenamiento", "Alcanzar los objetivos (ej. entregar en hora)", "Minimizar los errores de facturación"], correctAnswerIndex: 2 },
            { questionText: "La eficiencia se centra en lograr un producto con un coste logístico aceptable.", options: ["Verdadero, minimiza recursos", "Falso, solo se centra en objetivos", "Verdadero, pero ignora tiempo", "Falso, es igual a eficacia"], correctAnswerIndex: 0 },
            { questionText: "¿Qué se entiende por aprovisionamiento?", options: ["Actividad de recibir devoluciones", "Proceso de adquisición y suministro de materiales o productos", "Operación exclusiva de picking", "Solo gestión de documentación administrativa"], correctAnswerIndex: 1 },
            { questionText: "El stock de seguridad sirve para evitar roturas de stock por variaciones en la demanda.", options: ["Verdadero, actúa como buffer", "Falso, solo para stock obsoleto", "Verdadero, pero solo en almacenes comerciales", "Falso, aumenta costes innecesarios"], correctAnswerIndex: 0 },
            { questionText: "¿Cuál es la primera actividad en la secuencia de un almacén?", options: ["Área de picking", "Muelle / Área de descarga", "Área de expedición", "Playa de envíos"], correctAnswerIndex: 1 },
            { questionText: "El flujo del almacén sigue: proveedores → almacén → producción → almacén (producto final) → cliente externo.", options: ["Verdadero, incluye doble paso por almacén", "Falso, solo un paso por almacén", "Verdadero, pero ignora cross-docking", "False, producción es externa"], correctAnswerIndex: 0 },
            { questionText: "¿Qué incluye el área de almacenaje?", options: ["Solo la zona de picking", "Silos o zonas buffer/pulmón de ubicación", "Playa de expediciones", "Área de envíos"], correctAnswerIndex: 1 },
            { questionText: "Los espacios de reciclaje forman parte de los espacios auxiliares de un almacén.", options: ["Verdadero, junto con logística inversa", "Falso, solo para producción", "Verdadero, pero opcionales", "Falso, no son necesarios"], correctAnswerIndex: 0 },
            { questionText: "¿Cuál es una característica de la descarga en muelle (trasera)?", options: ["Requiere mucho espacio exterior para maniobras", "Se aplica el principio LIFO (Last In, First Out)", "Solo se usa para vehículos abiertos", "Implica mayor riesgo de caída de mercancía"], correctAnswerIndex: 1 },
            { questionText: "En la descarga en plano se necesita carretilla elevadora o apilador eléctrico.", options: ["Verdadero, por ser exterior", "Falso, usa transpaleta", "Verdadero, pero solo para vehículos cerrados", "Falso, es más seguro"], correctAnswerIndex: 0 },
            { questionText: "¿Qué provoca un cuello de botella en el flujo del almacén?", options: ["Aumento de rotación de stock", "El flujo se detiene por falta de ritmo", "Mayor eficiencia en expedición", "Reducción de costes en personal"], correctAnswerIndex: 1 },
            { questionText: "Una consecuencia de un cuello de botella para el cliente externo es la pérdida de imagen.", options: ["Verdadero, afecta servicio", "Falso, solo interno", "Verdadero, pero solo costes", "Falso, mejora imagen"], correctAnswerIndex: 0 },
            { questionText: "¿Cuál es una causa común de cuello de botella?", options: ["Exceso de inversión en maquinaria", "Maquinaria defectuosa o obsoleta", "Formación excesiva del personal", "Organización perfecta de tiempos"], correctAnswerIndex: 1 },
            { questionText: "Para el cliente interno, un cuello de botella implica personal parado y aumento de costes.", options: ["Verdadero, retrasos internos", "Falso, reduce costes", "Verdadero, pero solo externo", "Falso, acelera producción"], correctAnswerIndex: 0 },
            { questionText: "¿Qué es el \"picking\"?", options: ["Selección y preparación de pedidos para clientes", "Recepción inicial de la mercancía", "Proceso de devolución de productos", "Control financiero de facturas"], correctAnswerIndex: 0 },
            { questionText: "¿Para qué sirve el área de cuarentena o devolución?", options: ["Almacenar productos finales listos", "Guardar mercancía en espera de devolución o revisión", "Preparar pedidos de picking", "Reciclar embalajes vacíos"], correctAnswerIndex: 1 },
            { questionText: "El área de cuarentena debe estar cerrada con llave para evitar robos.", options: ["Verdadero, por seguridad", "Falso, siempre abierta", "Verdadero, solo para peritos", "Falso, no requiere procedimiento"], correctAnswerIndex: 0 },
            { questionText: "¿Qué incluye el espacio dedicado a la logística inversa en un almacén?", options: ["Solo oficinas y vestuarios", "Gestión de devoluciones y reciclaje", "Área de picking exclusiva", "Parking para vehículos externos"], correctAnswerIndex: 1 },
            { questionText: "Los pasillos y zonas de tránsito no son espacios necesarios para el almacenaje.", options: ["Verdadero, opcionales", "Falso, esenciales para tránsito", "Verdadero, solo en muelles", "Falso, pero solo para seguridad"], correctAnswerIndex: 1 },
            { questionText: "¿Qué documento acredita la entrega cuando el cliente lo firma?", options: ["Carta de porte", "Factura comercial", "Albarán", "Pedido de compra"], correctAnswerIndex: 2 },
            { questionText: "El proceso de recepción comienza con la verificación del precinto del vehículo.", options: ["Verdadero, para seguridad", "Falso, comienza con descarga", "Verdadero, pero opcional", "Falso, solo PDA"], correctAnswerIndex: 0 },
            { questionText: "¿Qué se comprueba en la descarga durante la recepción?", options: ["Solo la cantidad", "Cantidad, desperfectos y manipulaciones", "Coste logístico total", "Motivación del transportista"], correctAnswerIndex: 1 },
            { questionText: "La verificación en recepción puede realizarse con PDA para mayor precisión.", options: ["Verdadero, reduce errores", "Falso, solo manual", "Verdadero, pero aumenta tiempo", "Falso, no aplica"], correctAnswerIndex: 0 },
            { questionText: "En la recepción, después de la descarga, se emiten etiquetas y se distribuye la mercancía.", options: ["Verdadero, incluye agrupamiento", "Falso, solo verificación", "Verdadero, pero solo para cuarentena", "Falso, post-administración"], correctAnswerIndex: 0 },
            { questionText: "¿Qué documento se utiliza en la recepción de mercancía?", options: ["Albarán", "Factura proforma", "Código QR", "Layout"], correctAnswerIndex: 0 },
            { questionText: "El albarán es un documento que justifica la entrega de la mercancía.", options: ["Verdadero, con firma", "Falso, solo factura", "Verdadero, pero obligatorio", "Falso, para internos"], correctAnswerIndex: 0 },
            { questionText: "¿Qué es un palet?", options: ["Plataforma que facilita manipulación y transporte de mercancías", "Documento aduanero", "Software de trazabilidad", "Indicador KPI"], correctAnswerIndex: 0 },
            { questionText: "El europalet mide 1200 x 800 mm.", options: ["Verdadero, estándar europeo", "Falso, 1000 x 800 mm", "Verdadero, pero solo para contenedores", "Falso, variable"], correctAnswerIndex: 0 },
            { questionText: "¿Qué es un contenedor?", options: ["Caja de grandes dimensiones para transporte internacional de mercancías", "Documento de devolución", "Equipo de protección personal", "Etiqueta RFID"], correctAnswerIndex: 0 },
            { questionText: "Los contenedores marítimos permiten transporte intermodal (barco, tren, camión).", options: ["Verdadero, eficiente", "Falso, solo marítimo", "Verdadero, pero no tren", "Falso, solo camión"], correctAnswerIndex: 0 },
            { questionText: "¿Qué herramienta facilita la comunicación electrónica entre empresas?", options: ["PDA", "EDI", "Código QR", "Palet"], correctAnswerIndex: 1 },
            { questionText: "El EDI permite intercambiar documentos como pedidos y facturas de manera digital.", options: ["Verdadero, intercambia datos", "Falso, solo verbal", "Verdadero, pero manual", "Falso, no facturas"], correctAnswerIndex: 0 },
            { questionText: "¿Qué es un KPI en logística?", options: ["Indicador clave de desempeño (Key Performance Indicator)", "Documento de aduanas", "Tipo de embalaje", "Método de etiquetado"], correctAnswerIndex: 0 },
            { questionText: "Los KPI ayudan a medir la eficacia de las operaciones logísticas.", options: ["Verdadero, como tasa de rotura", "Falso, solo costes", "Verdadero, pero solo calidad", "Falso, no miden"], correctAnswerIndex: 0 },
            { questionText: "¿Qué tipo de almacén contiene materia prima y productos semielaborados?", options: ["Comercial", "Industrial", "De tránsito", "Para mercancías peligrosas"], correctAnswerIndex: 1 },
            { questionText: "Los almacenes comerciales son el punto final de la cadena y contienen mercancía para el cliente final.", options: ["Verdadero, distribución final", "Falso, producción", "Verdadero, pero industriales", "Falso, tránsito"], correctAnswerIndex: 0 },
            { questionText: "¿Qué diferencia a un almacén cubierto de uno descubierto?", options: ["Ofrece menos seguridad pero es más barato", "Protege del clima y ofrece más seguridad, pero es más caro", "Se usa solo para picking", "No requiere espacios auxiliares"], correctAnswerIndex: 1 },
            { questionText: "Los almacenes para mercancías peligrosas no siguen una normativa específica.", options: ["Verdadero, libre", "Falso, fichas de seguridad", "Verdadero, pero opcional", "Falso, solo animales"], correctAnswerIndex: 1 },
            { questionText: "¿Qué es cross-docking?", options: ["Técnica para evitar almacenamiento, distribuyendo directamente la mercancía", "Almacenaje prolongado en cámaras", "Método de rotación de stock", "Estrategia de motivación de personal"], correctAnswerIndex: 0 },
            { questionText: "El cross-docking consiste en almacenar mercancía durante largos periodos antes de su expedición.", options: ["Verdadero, tránsito largo", "Falso, mínimo almacenamiento", "Verdadero, directo", "Falso, indirecto"], correctAnswerIndex: 1 },
            { questionText: "Un almacén es un local para depositar mercancías para su posterior venta o distribución.", options: ["Verdadero, definición básica", "Falso, solo venta", "Verdadero, pero comercial", "Falso, no distribución"], correctAnswerIndex: 0 },
            { questionText: "¿Qué materiales auxiliares se almacenan en un almacén industrial?", options: ["Solo productos finales", "Materiales de mantenimiento y embalajes", "Mercancía para cliente final", "Solo granjas para animales"], correctAnswerIndex: 1 },
            { questionText: "El embalaje protege la mercancía durante transporte y almacenaje.", options: ["Verdadero, esencial", "Falso, solo transporte", "Verdadero, pero opcional", "Falso, no almacenaje"], correctAnswerIndex: 0 },
            { questionText: "El just in time consiste en producir o entregar lo necesario en el momento justo.", options: ["Verdadero, minimiza stock", "Falso, maximiza", "Verdadero, pero solo producción", "Falso, no entrega"], correctAnswerIndex: 0 },
            { questionText: "¿Qué define a un grupo?", options: ["Conjunto de personas con objetivos comunes y sinergia", "Conjunto de personas que trabajan juntas sin compartir metas", "Equipo con habilidades complementarias", "Personal motivado con líder fijo"], correctAnswerIndex: 1 },
            { questionText: "Un equipo eficaz requiere sinergia, donde el resultado es superior a la suma de las partes individuales.", options: ["Verdadero, 1+1=3", "Falso, igual suma", "Verdadero, pero sin comunicación", "Falso, solo grupo"], correctAnswerIndex: 0 },
            { questionText: "¿Cuáles son las tres grandes áreas de gestión del almacén?", options: ["Recepción, picking y salida", "Operativo, documental (administrativo) y comercial", "Industrial, comercial y de tránsito", "Verbal, no verbal y asertiva"], correctAnswerIndex: 1 },
            { questionText: "El espíritu de equipo implica trabajar de forma coordinada con un líder y compromiso.", options: ["Verdadero, con confianza", "Falso, sin líder", "Verdadero, pero sin compromiso", "Falso, individual"], correctAnswerIndex: 0 },
            { questionText: "¿Qué es la comunicación?", options: ["Solo el intercambio verbal entre emisor y receptor", "Capacidad de relacionarse con el entorno (emisor → mensaje → receptor)", "Herramienta solo para resolver conflictos", "Proceso que ignora la asertividad"], correctAnswerIndex: 1 },
            { questionText: "La comunicación en el almacén puede ser verbal o no verbal.", options: ["Verdadero, ambos tipos", "Falso, solo verbal", "Verdadero, pero no asertiva", "Falso, solo entorno"], correctAnswerIndex: 0 },
            { questionText: "¿Qué caracteriza la asertividad en la comunicación?", options: ["Imponer decisiones sin reconocer errores", "Resolver conflictos buscando soluciones y reconociendo errores", "Evitar toda relación con el entorno", "Cambiar a los demás sin auto-reflexión"], correctAnswerIndex: 1 },
            { questionText: "Para evaluar la calidad del trabajo, una pregunta clave es: \"¿Se cumplen los objetivos?\".", options: ["Verdadero, junto con tiempo y bien hecho", "Falso, solo producto correcto", "Verdadero, pero ignora fallos", "Falso, no objetivos"], correctAnswerIndex: 0 },
            { questionText: "¿Cuál es un indicador de calidad en el almacén?", options: ["Aumento intencional de tiempo perdido en expedición", "Tasa de ruptura de stock", "Ignorar el servicio postventa", "Errores voluntarios en facturación"], correctAnswerIndex: 1 },
            { questionText: "El índice de satisfacción del cliente no es un indicador de calidad.", options: ["Verdadero, irrelevante", "Falso, es clave", "Verdadero, solo interno", "Falso, pero opcional"], correctAnswerIndex: 1 },
            { questionText: "¿Qué es el estándar GS1-128?", options: ["Un sistema para control de stock mínimo", "Sistema de códigos de barras para identificación de cajas o palés", "Método de pago internacional", "Herramienta para gestión de personal"], correctAnswerIndex: 1 },
            { questionText: "Los productos se clasifican jerárquicamente: Familia → Subfamilia → Grupo → Subgrupo.", options: ["Verdadero, clasificación estándar", "Falso, inversa", "Verdadero, pero sin subgrupo", "Falso, no jerárquica"], correctAnswerIndex: 0 },
            { questionText: "¿Qué permite la trazabilidad en la cadena de suministro?", options: ["Solo reducir costes de transporte", "Seguimiento (tracking y tracing) del lote, fecha y hora del producto", "Aumentar el tiempo de picking", "Eliminar la necesidad de PDA"], correctAnswerIndex: 1 },
            { questionText: "¿Qué significa trazabilidad hacia atrás?", options: ["Seguir el recorrido del producto desde el cliente hasta el origen", "Solo controlar stock en almacén", "Método de rotación de mercancía", "Sinónimo de FIFO"], correctAnswerIndex: 0 },
            { questionText: "La trazabilidad hacia adelante consiste en conocer a quién se entregó cada lote.", options: ["Verdadero, seguimiento futuro", "Falso, solo atrás", "Verdadero, pero no lote", "Falso, no entrega"], correctAnswerIndex: 0 },
            { questionText: "¿Qué ventaja ofrece una PDA en el movimiento de mercancía?", options: ["Aumenta los errores y el tiempo", "Facilita codificación, identificación y trazabilidad, reduciendo costes", "Solo se usa para comunicación verbal", "Elimina la necesidad de espacios auxiliares"], correctAnswerIndex: 1 },
            { questionText: "Una PDA reduce el tiempo de trabajo y aumenta la seguridad en el almacén.", options: ["Verdadero, menos errores", "Falso, aumenta tiempo", "Verdadero, pero no seguridad", "Falso, solo codificación"], correctAnswerIndex: 0 },
            { questionText: "¿Qué significa FIFO?", options: ["First In, First Out (primero en entrar, primero en salir)", "Free Input, Free Output", "Fast Information for Operators", "Flexible Inventory for Orders"], correctAnswerIndex: 0 },
            { questionText: "El método LIFO significa que la última mercancía en entrar es la primera en salir.", options: ["Verdadero, último primero", "Falso, primero primero", "Verdadero, pero solo FEFO", "Falso, no salida"], correctAnswerIndex: 0 },
            { questionText: "¿Qué es un stock obsoleto?", options: ["Productos deteriorados, caducados o que ya no tienen salida comercial", "Mercancía lista para cross-docking", "Pedidos en preparación", "Material auxiliar"], correctAnswerIndex: 0 },
            { questionText: "¿Qué sistema de almacenaje ofrece acceso directo y es ideal para muchas referencias con pocas unidades por referencia?", options: ["Sistema en bloque", "Estantería convencional (Rack sistema)", "Drive-In", "Flow Rail"], correctAnswerIndex: 1 },
            { questionText: "En el sistema de estantería con base móvil, ¿cuál es el método principal y el aprovechamiento del espacio?", options: ["LIFO, medio", "FIFO, muy alto (elimina pasillos fijos)", "FEFO, bajo", "Ninguno, bajo"], correctAnswerIndex: 1 },
            { questionText: "¿Para qué se usa típicamente el sistema Cantilever?", options: ["Productos homogéneos de alta rotación", "Tubos, maderas, barras metálicas o perfiles industriales", "Picking de productos pequeños", "Almacenes automáticos"], correctAnswerIndex: 1 },
            { questionText: "El sistema Flow Rail por gravedad aplica FIFO y tiene muy alto aprovechamiento del espacio.", options: ["Verdadero, para productos homogéneos", "Falso, LIFO", "Verdadero, pero baja rotación", "Falso, no gravedad"], correctAnswerIndex: 0 },
            { questionText: "¿Qué caracteriza al sistema en bloque (apilamiento directo)?", options: ["Acceso directo, muchas referencias", "LIFO, muy alto espacio, para pocas referencias resistentes", "FIFO, media adaptación", "FEFO, alta densidad"], correctAnswerIndex: 1 },
            { questionText: "En el sistema Drive-In, el método es LIFO y es para alta densidad con rotación baja o media.", options: ["Verdadero, entrada única", "Falso, FIFO", "Verdadero, pero alta rotación", "Falso, muchas referencias"], correctAnswerIndex: 0 },
            { questionText: "¿Qué diferencia al sistema Drive-Through del Drive-In?", options: ["LIFO vs. FIFO (salida opuesta)", "Bajo vs. alto espacio", "Manual vs. automático", "Pequeños vs. grandes productos"], correctAnswerIndex: 0 },
            { questionText: "Las estanterías dinámicas por gravedad son FIFO y útiles para productos con caducidad (FEFO).", options: ["Verdadero, alta rotación", "Falso, LIFO", "Verdadero, pero baja densidad", "Falso, no caducidad"], correctAnswerIndex: 0 },
            { questionText: "El sistema Push-Back es LIFO y permite varias paletas por canal con rotación media.", options: ["Verdadero, alto espacio", "Falso, FIFO", "Verdadero, pero baja rotación", "Falso, acceso directo"], correctAnswerIndex: 0 },
            { questionText: "¿Para qué se usa el sistema de estanterías Shuttle (lanzadera)?", options: ["Baja densidad, manual", "Muy alto espacio, FIFO/LIFO, rotación media-alta en alta densidad", "Solo picking pequeño", "Reducción de oxígeno"], correctAnswerIndex: 1 },
            { questionText: "Los sistemas automáticos (AS/RS) ofrecen muy alto espacio y precisión con FIFO/FEFO.", options: ["Verdadero, automatizados", "Falso, manual", "Verdadero, pero baja adaptación", "Falso, no trazabilidad"], correctAnswerIndex: 0 },
            { questionText: "El sistema autoportante integra la estructura como parte del edificio con excelente espacio.", options: ["Verdadero, para grandes industriales", "Falso, solo pequeño", "Verdadero, pero LIFO exclusivo", "Falso, no automático"], correctAnswerIndex: 0 },
            { questionText: "Según la Regla de Pareto en ubicaciones, la categoría A representa 80% de movimientos con 20% de referencias.", options: ["Verdadero, alta rotación cerca", "Falso, baja rotación", "Verdadero, pero 5%", "Falso, media"], correctAnswerIndex: 0 },
            { questionText: "El principio de ubicación enfatiza saber qué y dónde tengo para evitar stock fantasma y rutas ineficientes.", options: ["Verdadero, eficiencia", "Falso, solo qué", "Verdadero, pero no rutas", "Falso, tiempo perdido"], correctAnswerIndex: 0 },
            { questionText: "FEFO significa First Expire First Out, prioritizando caducidad.", options: ["Verdadero, para perecederos", "Falso, First In", "Verdadero, pero no salida", "Falso, precio"], correctAnswerIndex: 0 },
            { questionText: "¿Qué es la prevención según la LPRL (Ley 31/1995)?", options: ["Solo evitar accidentes mayores", "Medidas para evitar o disminuir riesgos derivados del trabajo en todas las fases", "Únicamente salud física", "Ausencia de enfermedad"], correctAnswerIndex: 1 },
            { questionText: "¿Qué es un riesgo laboral?", options: ["Posibilidad de daño derivado del trabajo", "Solo lesión corporal grave", "Estado de bienestar", "Enfermedad no profesional"], correctAnswerIndex: 0 },
            { questionText: "La salud según OMS es estado completo de bienestar físico, mental y social.", options: ["Verdadero, no solo ausencia de enfermedad", "Falso, solo físico", "Verdadero, pero no social", "Falso, solo mental"], correctAnswerIndex: 0 },
            { questionText: "¿Qué es un accidente de trabajo?", options: ["Lesión por cuenta propia", "Lesión corporal por consecuencia del trabajo por cuenta ajena", "Enfermedad contraída fuera", "Bienestar derivado"], correctAnswerIndex: 1 },
            { questionText: "¿Qué es una enfermedad profesional?", options: ["Contraída por trabajo por cuenta ajena en actividades específicas", "Lesión accidental", "Estado de bienestar", "Riesgo no derivado"], correctAnswerIndex: 0 },
            { questionText: "Un derecho de los trabajadores en LPRL es la evaluación de riesgos y equipos de protección.", options: ["Verdadero, protección eficaz", "Falso, solo obligaciones", "Verdadero, pero no participación", "Falso, no equipos"], correctAnswerIndex: 0 },
            { questionText: "Una obligación de los trabajadores es usar correctamente los equipos de protección y informar riesgos.", options: ["Verdadero, velar por seguridad", "Falso, solo empresa", "Verdadero, pero no informar", "Falso, desconectar seguridad"], correctAnswerIndex: 0 },
            { questionText: "¿Qué es la ergonomía en el almacén?", options: ["Adaptación del puesto de trabajo para mejorar seguridad y rendimiento", "Sistema de etiquetado", "Método de rotación LIFO", "Software de picking"], correctAnswerIndex: 0 },
            { questionText: "La ergonomía busca reducir riesgos laborales y aumentar la eficiencia.", options: ["Verdadero, previene daños", "Falso, solo eficiencia", "Verdadero, pero no riesgos", "Falso, aumenta riesgos"], correctAnswerIndex: 0 },
            { questionText: "En almacenes, los equipos de protección individual incluyen cascos, guantes y calzado de seguridad.", options: ["Verdadero, según riesgos", "Falso, solo colectivos", "Verdadero, pero opcionales", "Falso, no calzado"], correctAnswerIndex: 0 },
            { questionText: "La LPRL obliga a la empresa a informar y consultar a trabajadores sobre riesgos.", options: ["Verdadero, participación", "Falso, solo evaluar", "Verdadero, pero no consultar", "Falso, trabajadores solos"], correctAnswerIndex: 0 },
            { questionText: "No poner fuera de funcionamiento dispositivos de seguridad es una obligación del trabajador.", options: ["Verdadero, contribuir", "Falso, empresa solo", "Verdadero, pero opcional", "Falso, no informar"], correctAnswerIndex: 0 },
            { questionText: "En muelles, sistemas de bloqueo y rampas niveladoras mejoran la seguridad en descargas.", options: ["Verdadero, previenen caídas", "Falso, solo eficiencia", "Verdadero, pero no bloqueo", "Falso, plano mejor"], correctAnswerIndex: 0 },
            { questionText: "Para mercancías peligrosas, se requieren fichas de seguridad y cumplimiento normativo.", options: ["Verdadero, LPRL aplica", "Falso, no normativo", "Verdadero, pero no fichas", "Falso, libre"], correctAnswerIndex: 0 },
            { questionText: "La flexibilidad ante situaciones cambiantes es un indicador de calidad relacionado con salud y seguridad.", options: ["Verdadero, respuesta grado", "Falso, solo calidad", "Verdadero, pero no salud", "Falso, no indicador"], correctAnswerIndex: 0 },
            // New Image-Based Questions
            { imageUrl: "https://i.postimg.cc/vH2JdYhn/Almacenaje-m-vil.jpg", questionText: "Observa la imagen. ¿Qué sistema de almacenaje se caracteriza por tener estanterías montadas sobre bases móviles que se desplazan por raíles?", options: ["Almacenaje móvil", "Sistema Drive-In", "Sistema Cantilever", "Sistema autoportante"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/J4YfWrx1/Sistema-autom-ticos.jpg", questionText: "La imagen muestra un sistema de almacenaje totalmente automatizado con transelevadores. ¿Cómo se denomina este sistema?", options: ["Sistema automático (AS/RS)", "Estantería convencional", "Sistema en bloque", "Sistema Push-Back"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/HsvqCYz7/Sistema-autoportante.jpg", questionText: "Este tipo de almacén, como el de la imagen, utiliza las propias estanterías como parte de la estructura del edificio. ¿Qué sistema es?", options: ["Sistema autoportante", "Sistema Flow Rail", "Almacenaje móvil", "Sistema Drive-Through"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/c4kpNxhn/Sistema-Cantilever.jpg", questionText: "¿Qué sistema, ideal para cargas largas y voluminosas como tubos o maderas, se muestra en la imagen?", options: ["Sistema Cantilever", "Sistema en bloque", "Sistema Shuttle", "Estantería convencional"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/L6QcM9Df/Sistema-de-almacenamiento-din-mico.jpg", questionText: "La imagen muestra un sistema que utiliza la gravedad para desplazar las paletas sobre rodillos. ¿Cómo se conoce este principio general?", options: ["Sistema de almacenamiento dinámico", "Sistema estático en bloque", "Sistema Cantilever", "Sistema autoportante"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/T3yZdzNg/Sistema-de-estanter-a-convencional-o-Rack-sistema.jpg", questionText: "Identifica el sistema de almacenaje más común y versátil, que permite el acceso directo a cada paleta, como se ve en la imagen.", options: ["Sistema de estantería convencional (Rack)", "Sistema Drive-In", "Sistema Shuttle", "Almacenaje móvil"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/cLKVxpkF/Sistema-de-estanter-as-din-micas-Din-micas-por-gravedad.png", questionText: "Este sistema FIFO utiliza rodillos inclinados para que las paletas se deslicen de la zona de carga a la de descarga. ¿Qué sistema es?", options: ["Estanterías dinámicas por gravedad (FIFO)", "Sistema Push-Back (LIFO)", "Sistema Drive-In", "Sistema en bloque"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/QdBR82Y6/Sistema-de-estanter-as-din-micas-Estanter-as-shuttle-lanzadera.jpg", questionText: "En la imagen se ve un carro motorizado que transporta paletas dentro de las estanterías. ¿Qué sistema de almacenaje es?", options: ["Sistema Shuttle (Lanzadera)", "Sistema Cantilever", "Sistema Flow Rail manual", "Sistema autoportante"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/L8qr9cQt/Sistema-de-estanter-as-din-micas-push-back.jpg", questionText: "Este sistema de alta densidad, que opera bajo el principio LIFO, utiliza carros o rodillos para empujar las paletas hacia el fondo. ¿Cuál es?", options: ["Sistema Push-Back", "Sistema dinámico por gravedad (FIFO)", "Sistema Drive-Through", "Estantería convencional"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/htJHDkZN/Sistema-Drive-through.png", questionText: "Observa el diagrama. Si la carretilla puede entrar por un lado y salir por el otro, permitiendo una gestión FIFO, ¿de qué sistema se trata?", options: ["Sistema Drive-Through", "Sistema Drive-In", "Sistema Push-Back", "Sistema en bloque"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/6p7DWkb1/Sistema-Driven-in.jpg", questionText: "Este sistema de alta densidad tiene un único pasillo de acceso para carga y descarga (LIFO). ¿Cómo se llama el sistema que se muestra?", options: ["Sistema Drive-In", "Sistema Drive-Through", "Estantería convencional", "Almacenaje móvil"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/BndRXmd3/Sistema-en-bloque.jpg", questionText: "¿Qué sistema de almacenaje consiste en apilar la mercancía directamente una sobre otra sin estanterías, como se ve en la imagen?", options: ["Sistema en bloque", "Sistema autoportante", "Sistema Cantilever", "Sistema Shuttle"], correctAnswerIndex: 0 },
            { imageUrl: "https://i.postimg.cc/kgkLBTLf/Sistema-Flow-rail.jpg", questionText: "Este sistema se utiliza para picking de cajas o productos ligeros, utilizando la gravedad en estanterías de baja altura. ¿Cómo se denomina?", options: ["Sistema Flow Rail (Carton Flow)", "Sistema Drive-In para paletas", "Sistema Cantilever", "Sistema en bloque"], correctAnswerIndex: 0 }
        ];

        // DOM Elements
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const startBtn = document.getElementById('start-quiz-btn');
        const progressText = document.getElementById('progress-text');
        const timerEl = document.getElementById('timer');
        const questionImageContainer = document.getElementById('question-image-container');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const nextButtonContainer = document.getElementById('next-button-container');
        const resultsTitle = document.getElementById('results-title');
        const resultsMessage = document.getElementById('results-message');
        const finalTimeEl = document.getElementById('final-time');
        const scoreDisplay = document.getElementById('score-display');
        const scorePercentage = document.getElementById('score-percentage');
        const resultsButtons = document.getElementById('results-buttons');
        const reviewSection = document.getElementById('review-section');
        const incorrectList = document.getElementById('incorrect-questions-list');

        // State
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let selectedAnswers = [];
        let score = 0;
        let startTime = 0;
        let timerInterval;

        // Utility Functions
        const shuffleArray = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        };

        const formatTime = (totalSeconds) => {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        };
        
        const updateTimer = () => {
            const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
            timerEl.textContent = formatTime(elapsedSeconds);
        };

        const showScreen = (screen) => {
            startScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            screen.classList.remove('hidden');
        };

        // Quiz Logic
        const startQuiz = (questions) => {
            currentQuestions = questions;
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswers = Array(questions.length).fill(null);

            startTime = Date.now();
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
            
            showScreen(quizScreen);
            renderQuestion();
        };
        
        const startNewQuiz = () => {
            const shuffled = shuffleArray([...allQuestions]).slice(0, 20);
            startQuiz(shuffled);
        };
        
        const renderQuestion = () => {
            const question = currentQuestions[currentQuestionIndex];
            
            questionImageContainer.innerHTML = '';
            if (question.imageUrl) {
                const img = document.createElement('img');
                img.src = question.imageUrl;
                img.alt = "Imagen del sistema de almacenaje";
                img.className = "w-full h-auto max-h-60 object-contain mx-auto rounded-lg";
                questionImageContainer.appendChild(img);
            }

            progressText.textContent = `Pregunta ${currentQuestionIndex + 1} / ${currentQuestions.length}`;
            questionTextEl.innerHTML = question.questionText;

            optionsContainer.innerHTML = '';
            const optionPrefixes = ['A', 'B', 'C', 'D'];
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.innerHTML = `<span class="mr-3 font-bold text-blue-600">${optionPrefixes[index]}</span>${option}`;
                button.className = 'p-4 rounded-lg text-left font-semibold transition-all duration-300 border-2 bg-white text-gray-700 border-gray-300 hover:bg-blue-50 hover:border-blue-500';
                button.onclick = () => handleAnswer(index);
                optionsContainer.appendChild(button);
            });
            nextButtonContainer.innerHTML = '';
        };

        const handleAnswer = (selectedIndex) => {
            selectedAnswers[currentQuestionIndex] = selectedIndex;
            const question = currentQuestions[currentQuestionIndex];
            const isCorrect = selectedIndex === question.correctAnswerIndex;
            if (isCorrect) {
                score++;
            }

            Array.from(optionsContainer.children).forEach((btn, i) => {
                btn.disabled = true;
                btn.classList.add('disabled');
                if (i === question.correctAnswerIndex) {
                    btn.classList.add('correct');
                } else if (i === selectedIndex) {
                    btn.classList.add('incorrect');
                }
            });

            renderNextButton();
        };

        const renderNextButton = () => {
            const isLastQuestion = currentQuestionIndex === currentQuestions.length - 1;
            const button = document.createElement('button');
            button.textContent = isLastQuestion ? 'Finalizar Test' : 'Siguiente Pregunta';
            button.className = 'px-8 py-3 text-lg font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105 shadow-md';
            button.onclick = handleNextQuestion;
            nextButtonContainer.innerHTML = '';
            nextButtonContainer.appendChild(button);
        };

        const handleNextQuestion = () => {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                finishQuiz();
            }
        };

        const finishQuiz = () => {
            clearInterval(timerInterval);
            const elapsedTime = Math.round((Date.now() - startTime) / 1000);
            
            const incorrectQuestions = currentQuestions.filter((q, index) => selectedAnswers[index] !== q.correctAnswerIndex);
            const isPerfectScore = incorrectQuestions.length === 0;
            const percentage = Math.round((score / currentQuestions.length) * 100);

            resultsTitle.textContent = isPerfectScore ? '¡Excelente!' : 'Test Completado';
            resultsMessage.textContent = isPerfectScore ? 'Has respondido correctamente a todas las preguntas.' : 'Tu resultado final es:';
            finalTimeEl.textContent = `Tiempo total: ${formatTime(elapsedTime)}`;
            scoreDisplay.textContent = `${score} / ${currentQuestions.length}`;
            scorePercentage.textContent = `${percentage}%`;

            resultsButtons.innerHTML = '';
            if (!isPerfectScore) {
                const retryBtn = document.createElement('button');
                retryBtn.textContent = `Repetir Errores (${incorrectQuestions.length})`;
                retryBtn.className = "w-full md:w-auto px-6 py-3 text-lg font-bold text-white bg-green-600 rounded-lg hover:bg-green-700 transition-transform transform hover:scale-105 shadow-md hover:shadow-lg";
                retryBtn.onclick = () => startQuiz(incorrectQuestions);
                resultsButtons.appendChild(retryBtn);
            }
            const resetBtn = document.createElement('button');
            resetBtn.textContent = 'Empezar Nuevo Test';
            resetBtn.className = "w-full md:w-auto px-6 py-3 text-lg font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105 shadow-md hover:shadow-lg";
            resetBtn.onclick = startNewQuiz;
            resultsButtons.appendChild(resetBtn);

            if (!isPerfectScore) {
                incorrectList.innerHTML = '';
                incorrectQuestions.forEach(q => {
                    const li = document.createElement('li');
                    li.className = 'text-gray-700 border-b border-gray-200 py-2 last:border-b-0';
                    li.innerHTML = `<p class="font-semibold">${q.questionText}</p>
                                    <p class="text-green-700 text-sm mt-1">
                                      <span class="font-bold">Respuesta correcta:</span> ${q.options[q.correctAnswerIndex]}
                                    </p>`;
                    incorrectList.appendChild(li);
                });
                reviewSection.classList.remove('hidden');
            } else {
                reviewSection.classList.add('hidden');
            }
            
            showScreen(resultsScreen);
        };

        // Initial Setup
        startBtn.addEventListener('click', startNewQuiz);
        showScreen(startScreen);

    </script>
</body>
</html>